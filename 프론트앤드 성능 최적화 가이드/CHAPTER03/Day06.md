# DAY 6

## 🔖 오늘 읽은 범위 : 3장 홈페이지 최적화

---

    <aside>
    😃 **기억하고 싶은 내용**
    </aside>

### 이미지 지연 로딩

#### Intersection Observer

- 브라우저에서 제공하는 API 이를 통해 웹 페이지의 특정 요소를 관찰하면 페이지 스크롤 시, 해당 요소가 화면에 들어왔는지 아닌지 알려준다.
- 요소가 화면에 들어왔을 때만 함수를 호출

지연 로딩 방법 예시)

중복을 방지하고자 useEffect에서 인스턴스를 생성

- isIntersecting : 해당요소가 뷰포트 내에 들어왔는지를 나타내는 값.
- 이미지 로딩은 img 태그에 **src가 할당되는 순간** 일어난다.
    ⇒ 최초엔 할당하지 않다가 **콜백이 실행되는 순간** src를 할당함으로써 이미지 지연 로딩을 적용

### 이미지 사이즈 최적화

#### 이미지 포맷

- PNG
- JPG(JPEG)
- WebP

#### PNG

- 무손실 압축 방식 원본을 훼손 없이 압축하며 알파 채널을 지원하는 이미지 포맷
- 알파 채널: 투명도를 의미

#### JPG

- 압축 과정에서 정보 손실이 발생한다. 더 작은 사이즈로 압축 가능.
- 일반적으로 웹에서 이미지를 사용할 때는 JPG를 사용.

### WebP

- 무손실 압축과 손실 압축 모두 제공하는 **최신 이미지 포맷.**
- 다른 것들과 다르게 효율적으로 이미지 압축 가능.
- PNG 대비 26%, JPG 대비 25~34%

### [정리]

- 사이즈 : PNG > JPG > WebP
- 화질 : PNG =  WebP > JPG
- 호환성 : PNG = JPG > WebP

### Squoosh를 사용하여 이미지 변환

squoosh : 이미지를 변환해주는 어플리케이션

Resize 설정

- 원래 이미지 사이즈 2배로 설정
- Compress 섹션 압축방식: WebP, 압축률: 75
(압축률 값이 너무 크면 용량이 커지고 너무 작으면 화질이 많이 떨어진다. 70~80사이 권장)

Picture 태그 사용: 호환성 때문에 webP 지원하지 않는 브라우저 때문에

⇒ 다양한 타입의 이미지를 렌더링하는 컨테이너로 사용

이미지 지연 로딩

img태그에 src 값을 바로 넣지 않고 data-src 에 임시 저장한 뒤, Intersection Observer의 콜백이 실행 됬을 떄 data-src에 있는 값을 src로 옮겨 준다.

### 동영상 최적화

webM 파일 지원 안 하는 브라우저를 위해 video태그 사용

### 폰트 최적화

폰트의 변화로 발생하는 이 현상 FOUT, FOIT 이라고 함.

#### FOUT

- Edge 브라우저에서 폰트를 로드하는 방식
- 폰트의 다운로드 여부와 상관 없이 먼저 텍스트를 보여준 후 폰트가 다운로드 되면 그때 폰트를 적용하는 방식

#### FOIT

- 크롬, 사파리, 파이어폭스 등에서 폰트를 로드하는 방식.
- 폰트가 완전히 다운로드되기 전까지 텍스트 자체를 보여 주지 않습니다. 다운로드가 완료 된 후 적용된 텍스트를 보여준다.
- 크롬에서 3초 FOIT: 3초가 지나도 폰트가 다운로드 되지 않으면 기본 폰트로 텍스트를 보여준다.

### 폰트 최적화 두가지 방식

- 폰트 적용 시점 제어
- 폰트 사이즈를 줄이는 방법

#### 폰트 적용 시점 제어

- css의 font-display 속성을 이용하여 폰트의 적용 시점을 제어
- font-face에서 설정 가능
  - auto: 브라우저 기본 동작(기본값)
  - block: FOIT(timeout = 3s)
  - swap: FOUT
  - fallback: FOIT(timeout = 0.1s) / 3초 후에도 불러오지 못한 경우 기본 폰트로 유지, 이후 캐시
  - optional: FOIT(timeout = 0.1s) / 이후 네트워크 상태에 따라 기본 폰트로 유지할지 결정, 이후 
  
  캐시
- fallback, optionaldjs FOIT 방식이지만 텍스트를 보여주지 않는 시간이 3초가 아닌 0.1초.
- fallback의 경우 3초 후에도 폰트를 다운로드 하지 못할 경우 이후에 다운이 되었어도 캐시로 적용되서 폰트가 바뀌지 않는 것처럼 보인다.(새로고침 했을 시 적용)

#### 폰트 파일 크기 줄이기

- 폰트 포맷 변경
  - 보통 TTF, OTF 포맷. TTF 포맷은 파일 크기가 크다. 매번 리소스를 다운로드해야 하는 웹 환경에서는 적절하지 않다.
  - WOFF: Web Open Font Format, 웹을 위한 폰트. 이는 TTF를 압축하여 웹에서 더욱 빠르게 로드할 수 있도록 만들었따. WOFF2 더 향상된 압축방식을 적용한 포맷도 있다.

    [폰트 포맷별 파일 크기 비교]

    파일크기    EOF > TTF/OTF > WOFF > WOFF2

- 특정 부분에서만 쓰는 폰트인 경우
  - 모든 문자가 아닌 일부 문자의 폰트 정보만 가지고 있는 경우 **서브셋폰트**라고 한다.
  - Data-URI : data 스킴이 접두어로 붙은 문자열 형태의 데이터. 파일을 문자열 형태로 변환하여 문서(HTML, CSS, 자바스크립트 등)에 인라인으로 삽입하는 것.

    Data-URI 형태로 만들어서 App.css파일에 넣어 두면 별도의 네트워크 로드없이 App.css파일에서 폰트 사용 가능(단, 여기선 굉장히 작은 파일이었기에 가능). 커지면 App.css파일 로드하는데 오래걸림.

### 캐시 최적화

Diagnostics 섹션의 Serve static assets with an efficient cache policy(네트워크를 통해 다운로드 하는 리소스에 캐시를 적용하라는 의미)

### 캐시?

- 자주 사용하는 데이터나 값을 미리 복사해 둔 임시 저장 공간 또는 저장하는 동작.
- 메모리 캐시 : 메모리에 저장하는 방식(메모리: RAM
- 디스크 캐시 : 파일 형태로 디스크에 저장하는 방식.

#### Cache-Control

- 리소스의 응답 헤더에 설정되는 헤더. 이 헤더를 통해 캐시를 어떻게 얼마나 적용해야 하는지 판단.
  - no-cache: 캐시를 사용하기 전 서버에 검사 후 사용.
      사용 전에 서버에 캐시된 리소스를 사용해도 되는지 한 번 체크하도록 하는 옵션
  - no-store: 캐시 사용 안 함.
      캐시를 사용하지 않는 옵션
  - public: 모든 환경에서 캐시 사용 가능.
      웹 리소스는 브라우저뿐만 아니라 웹 서버와 브라우저 사이를 연결하는 중간 캐시 서버에서도 캐시될 수 있다.
  - private: 브라우저 환경에서만 캐시 사용, 외부 캐시 서버에서는 사용 불가
      중간 서버에서 캐시를 적용하고 싶지 않을 때 사용.

  public, private 둘 다 max-age에서 설정한 시간 만큼 서버에 사용 가능 여부를 묻지 않고 캐시된 리소스를 바로 사용.
  유효시간이 지났다면 다시 체크하고 유효 시간만큼 더 사용.
  - max-age: 캐시의 유효기간
      초 단위로 얼마나 오래 캐시를 사용할 것인지 설정.

## 불필요한 CSS 제거

Reduce Unused CSS 항목.

### PurgeCss

- 파일에 들어 있는 모든 키워드를 추출하여 해당 키워드를 이름으로 갖는 css클래스만 보존하고 나머지 매칭되지 않은 클래스는 모두 지우는 방식으로 css 최적화 실행.

    <aside>
        🤔 **오늘의 파트에 대한 소감**
    </aside>

- 최적화 하는 방식들은 매우 비슷하게 이루어지는 것 같다. 적절한 곳에 최적화를 적용시키면 좋을 것 같다.

    <aside>
        🔎 **추가로 알게 된 것 (책 내용 +알파로 궁금한 것, 이해가 가지 않는 것 등)**
    </aside>

- useRef(이거 뭐드라?)
- Picture 태그
- data-srcset? , data- 태그???

---