# 오늘 읽은 내용

## CHAPTER 12 단위 테스트

### TIL 3줄 요약

- 변하지 않을 테스트를 만들기 위해 노력해라.
- 행위를 테스트하라.
- 테스트에 로직을 넣지 말고 DAMP를 우선하라.

### TIL (Today I Learned) 날짜

2023.06.06

### 오늘 읽은 범위

단위 테스트란? 단일클래스나 메서드처럼 범위가 상대적으로 좁은 테스트

테스트의 목적
가장 중요한 것은 **버그 예방**
엔지니어의 생산성 개선

단위테스트의 특성

- 구글의 테스트 크기 정의에 따르면 단위 테스트는 대체로 작은 테스트에 속한다. 작은 테스트는 빠르고 결정적이어서 개발자들이 수시로 수행하며 피드백을 즉각으로 얻을 수 있다.
- 대상 코드와 동시에 작성할 수 있을 만큼 작성하기 쉽다.
- 테스트 커버리지를 높이기 좋다. 커버리지가 높다면 기존 동작을 망가뜨리지 않으리라는 확신 속에서 코드 변경이 가능하다.
- 개념적으로 간단하고 시스템의 특정 부분에 집중하므로 실패 시 원인 파악이 쉽다.
- 대상 시스템의 사용법과 의도한 동작 방식을 알려주는 문서자료 혹은 예제 코드 역활을 해준다.

12.1 유지보수하기 쉬어야 한다.

12.2 깨지기 쉬운 테스트 예방하기

깨지기 쉬운 테스트란? 
실제로 버그가 없음에도, 심지어 검증 대상 코드와는 관련 조차 없는 변경 떄문에 실패하는 테스트

12.2.1 변하지 않는 테스트로 만들기 위해 노력하자.

이상적인 테스트라면 변하지 않아야 한다.
대상 시스템의 요구사항이 바뀌지 않는 한 절대 수정할 일이 없어야 한다.

기본적인 변경 유형 4가지

- *순수 리펙터링*
내부만 리펙터링 한다면 테스트는 변경되지 않아야 한다.(성능 최적화, 코드 가독성 개선등이 해당)
구글의 대규모 변경을 순수 리펙터링 용도로 자주 수행한다.

리펙터링 과정에서 테스트가 변경된다면

1. 시스템의 행위가 달라졌다.
2. 테스트의 추상화 수준이 적절하지 않다는 뜻

- *새로운 기능 추가*
새로운 기능이나 행위를 추가할 때 기존 행위에 영향을 주지 않는다. 
새로운 기능을 추가했는데 테스트를 변경해야 한다면 테스트 검증하는 기능에 의도치 않은 영향을 주었거나 테스트 자체에 문제가 있다는 뜻이다.

- *버그 수정*
버그수정과 동시에 누락됐던 테스트를 추가해야 한다. 통상적으로 기존 테스트가 변경되지 않아야 한다.

- *행위 변경*
기존 행위를 변경하는 경우에는 기존 테스트 역시 변경되어야 한다.
테스트를 변경한다는 것은 시스템이 한 약속을 '의도적으로' 변경한다는 뜻이다.

=> 요점은 리팩터링, 새 기능 추가, 버그 수정시 기존 테스트를 손볼 일이 없어야 한다는 것.

12.2.2 공개 API를 이용해 테스트 하자.

12.2.3 상호작용이 아니라 상태를 테스트 하자.

시스템이 기대한 대로 동작하는지를 검증하는 방법

1. 상태 테스트
    메서드 호출 후 시스템 자체를 관찰한다.
2. 상호작용 테스트
    호출을 처리하는 과정에서 시스템이 다른 모듈들과 협력하여 기대한 일련의 동작을 수행하는지를 확인 한다.

상호작용테스트는 상태 테스트 보다 깨지기 쉽다.
이유는 공개 메서드 테스트보다 비공개 메서드 테스트가 깨지기 쉬운 이유와 같다.

우리가 진짜로 원하는 것은 결과가 '무엇'이냐지만, 상호작용 테스트는 결과에 도달하기까지 시스템이 '어떻게' 작동하냐를 확인하려고 한다.

12.3 명확한 테스트 작성하기

테스트가 실패하는 이유

1. 대상 시스템에 문제가 있거나 불완전하다. 테스트는 정확히 이 문제를 잡아낼 목적으로 설계된다. 실패 이유가 이것이라면 버그를 고치라는 경고로 보면 된다.
2. 테스트 자체에 결함이 있는 경우. 이 경우 대상 시스템에 문제가 없고 기존 테스트가 이런 이유로 실패했다면 깨지기 쉬운 테스트라는 것.

명확한 테스트란?
존재 이유와 실패 원인을 엔지니어가 곧바로 알아차릴 수 있는 테스트

12.3.1 완전하고 간결하게 만들기

완전한 테스트: 결과에 도달하기까지의 논리를 읽는 이가 이해하는 데 필요한 모든 정보를 본문에 담고 있는 테스트.

간결한 테스트: 코드가 산만하지 않고, 관련 없는 정보는 포함하지 않은 테스트.

두 특성 중 어느것도 갖추지 못해다면 안 좋은 테스트의 예이다.
테스트 본문에는 테스트를 이해하는데 필요한 정보를 모두 담아야 하며, 그와 동시에 눈을 어지럽히거나 관련 없는 정보는 담지 않아야 합니다.

12.3.2 메서드가 아니라 행위를 테스트 하자.

테스트를 메서드 별로 작성하기 말고 **행위별로 작성해라**

행위란? 특정 상태에서 특정한 일련의 입력을 받았을 때 시스템이 보장하는 '반응'을 뜻한다.

행위를 때로는 given/when/then을 써서 표현한다.
ex) given: 시스템의설정을 정의(은행잔고가 빈 상태에서)
when: 시스템이 수행할 작업을 정의  (돈을 인출하려 하면)
then: 결과를 검증 (거래를 거부한다)

메서드와 행위는 다대다 관계이다. 어떤 행위는 여러 메서드를 연계해야 완성된다.

행위 주도 테스트가 메서드 중심 테스트보다 명확한 이유

1. 자연어에 더 가깝게 읽히기 때문에 힘들여 분석하지 않아도 자연스럽게 이해할 수 있다.
2. 테스트 각각이 더 좁은 범위를 검사하기 때문에 원인과 결과가 더 분명하게 드러난다.
3. 각 테스트가 짧고 서술적어어서 이미 검사한 기능이 무엇인지 더 쉽게 확인가능하다.

테스트 구조는 행위가 부각되도록 구성해라.

이 패턴으로 작성된 테스트 코드는 세단계 깊이로 파악할 수 있다.

1. 먼저 테스트 메서드의 이름을 보고 검사하려는 행위를 간략하게 파악
2. 메서드 이름으로 충분하지 않다면 행위를 형식화해 설명한 given/when/then 주석을 읽는다.
3. 주석의 설명이 실제 코드로는 정확히 어떻게 표현됐는지 살펴볼 수 있다.

테스트 이름을 검사하는 행위에 아울리게 짓자

제품의 들어갈 코드라면 자세하고 구체적으로 쓸 필요가 없지만 
테스트를 위한 용도의 이름이라면 자세하고 구체적으로 쓸 필요가 있다.

주로 보고서에 담겨 전달될 것이기 때문에 매우 상세해도 괜찮다.

12.3.3 테스트에 논리를 넣지 말자

논리: 프로그래밍 언어에서 명령형 요소(연산자, 반복문, 조건문 등)

테스트 코드에선 스마트한 로직보다 직설적인 코드를 고집해야 한다.
서술적이고 의미 있는 테스트를 만들기 위한 약간의 중복은 허용하는 것이 좋다.

12.3.4 실패 메시지를 명확하게 작성하자.

테스트가 실패했을 때 엔지니어가 받아보게 되는 메시지에 관한 것.
원하는 결과, 실제 결과, 이 때 건네진 매개변수의 값을 명확히 알려주어야 한다.

좋은 실패 메시지라면 기대한 상태와 실제 상태를 명확하게 구분해 주고 결과가 만들어진 맥락 정보도 더 제공해야 한다.

12.4 테스트와 공유: DRY가 아니라 DAMP!

대부분의 소프트웨어는 반복하지 마라 라는 뜻의 DRY(Don't Repair Yourself)의 원칙을 따른다.

좋은 테스트는 안정적이고, 대상 시스템의 행위가 변경되면 실패하도록 설계된다.

테스트 코드는 DAMP(Descriptive And Meaningful Phrase) 서술적이고 의미있는 문구를 뜻한다.
단순하고 명료하게 만들어준다면 테스트에서 다소의 중복은 괜찮다.

12.4.1 공유값
공유 값을 정의한 후 여러 테스트에서 다양하게 조합해 사용하는 경우가 많다.

12.4.2 공유 셋업
셋업 메서드란?
하나의 테스트 스위트에 속한 테스트 각각을 수행하기 직전에 실행되는 메서드.
대상 객체와 협력 개게들을 생성하는데 매우 유용하다.

장점
더 깔끔하고 명확하게 정리. 초기화 로직이 반복되는 걸 없애준다.

단점
중요한 세부 정보를 셋업 메서드 속에 숨겨버려서 테스트가 완벽해지지 못하게 막는다.

12.4.3 공유 도우미 메서드와 공유 검증 메서드

하나의 목적에 집중하는 검증 메서드는 여전히 유용하다.
검증용 도우미 메서드는 입력에 대한 단 하나의 '개념적 사실'만을 검증한다.

12.4.4 테스트 인프라 정의하기

테스트 인프라: 다른 테스트 스위트와도 코드를 공유하는 코드.
주로 종단간 테스트나 통합 테스트 때 빛을 발한다.

12.5 마무리

단위 테스트는 예기치 못한 변경에도 시스템이 오래도록 잘 구동되게끔 보증하기 위해 소프트웨어 엔지니어가 할 수 있는 가장 강력한 도구이다.

12.6 정리

- 변하지 않는 테스트를 만들기 위해 노력해라.
- 공개 API를 통해 테스트해라.
- 상호작용이 아닌 상태를 테스트해라.
- 테스트를 완전하고 명확하게 만들어라.
- 메서드가 아닌 행위를 테스트해라.
- 행위가 부각되게끔 테스트를 구성해라.
- 테스트 이름은 검사하는 행위가 잘 드러나게 지어라.
- 테스트에 로직을 넣지 말아라.
- 실패 메시지를 명확하게 작성해라.
- 테스트들이 코드를 공유할 때 DRY 보다 DAMP를 우선해라.

### 오늘 읽은 소감은? 떠오르는 생각을 가볍게 적어보세요

테스트를 어떻게 해야할지 고민해보게 만드는 장.

### 궁금한 내용이 있거나, 잘 이해되지 않는 내용이 있다면 적어보세요

프런트의 단위테스트는 무엇일지 어떻게 하면 좋을지 고민해보기

### 해시태그: 키워드

#단위테스트